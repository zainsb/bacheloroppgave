@model List<Studentparlamentet_28.Models.KandidatSTV>

<!DOCTYPE html>

<html>
<head>
    <meta name="viewport" content="width=device-width" />
    <script type="text/javascript">
        //Hjelpevariabler

        $(function () {
            var antallKandidaterIListe = @Model.Count();
            var valgid = 0;
            var valgidtype = $("#hiddenValgtypeid").val();
            $("#divResultat").hide();
            $("#divFeilmld").hide();

            //Sjekker om et preferansevalg kjører
            $.ajax({
                url: '@Url.Action("PreferansevalgKjorer", "Bruker")',
                success: function (data) {
                    if (data == "true") {
                        window.location = "@Url.Action("PreferansevalgStartetEng", "Bruker")";
                    }
                    else if (data == "false") {
                        $("#start").show();
                    }
                }
            });


            if(antallKandidaterIListe == 0){
                $('#btnNullstillKandidater').attr("disabled", true);
            }

            //Nullstill kandidatliste
            $("#btnNullstillKandidater").click(function () {

                $.ajax({
                    url: '/Bruker/NullstillKandidatliste',
                    data: { valgtypeid: valgidtype },
                    type: 'GET',
                    dataType: 'json',
                    success: function (melding) {
                        if (melding == "OK") {
                            location.reload();
                        }
                    },
                    error: function (x, y, z) {
                    }
                });
            });

            //Lagrer kandidat i db og legger til en ny rad
            $("#btnLeggTilKandidat").click(function () {
                var navn = $('#kandidatNavn').val(); //Henter inn data fra felt
                leggTilRad(navn);
            });

            //Start preferansevalg
            $("#btnStartSTV ").click(function () {
                var beskrivelse = $('#BeskrivelseSTV').val(); //Henter inn data fra felt
                var antallRepresentanter = $("#antRepresentanter").val();
                var antallVaraRepresentanter = $("#antVaraRepresentanter").val();
                var grenseAntallVara = @Model.Count() + antallRepresentanter;

                $("#divFeilmld").hide();
                $("#divFeilTxt").html(" ");
                $("#divFeilRep").html(" ");
                $("#divFeilBeskrivelse").html(" ");

                //Om antall kandidater er mindre enn så starter ikke et valg
                if(antallKandidaterIListe < antallRepresentanter){
                    if(antallRepresentanter < 2){
                        $("#divFeilmld").show();
                        $("#divFeilTxt").html("Error, try again.");
                        $("#divFeilRep").html("<p style='color: red;'>*Has to be at least 2</p>");
                    }
                    if(beskrivelse == ""){
                        $("#divFeilmld").show();
                        $("#divFeilTxt").html("Error, try again.");
                        $("#divFeilBeskrivelse").html("<p style='color: red;'>*Fill in</p>");
                    }
                    $("#divFeilmld").show();
                    $("#divFeilTxt").html("The number of candidates for the election is less than the number of representatives to be elected.");
                    melding = "feil";
                }
                else if(antallRepresentanter == ""){
                    if(beskrivelse == ""){
                        $("#divFeilmld").show();
                        $("#divFeilTxt").html("Error, try again.");
                        $("#divFeilBeskrivelse").html("<p style='color: red;'>*Fill in</p>");
                    }
                    antallRepresentanter = "-";
                    $("#divFeilmld").show();
                    $("#divFeilTxt").html("Error, try again.");
                    $("#divFeilRep").html("<p style='color: red;'>*Fill in</p>");
                }
                else if(antallVaraRepresentanter == ""){
                    if(beskrivelse == ""){
                        $("#divFeilmld").show();
                        $("#divFeilTxt").html("Error, try again.");
                        $("#divFeilBeskrivelse").html("<p style='color: red;'>*Fill in</p>");
                    }
                    antallRepresentanter = "-";
                    $("#divFeilmld").show();
                    $("#divFeilTxt").html("Error, please try again.");
                    $("#divFeilVaraRep").html("<p style='color: red;'>*Fill in</p>");
                }
                else if(isNaN(antallVaraRepresentanter))
                {
                    $("#divFeilmld").show();
                    $("#divFeilTxt").html("Error, please try again.");
                    $("#divFeilVaraRep").html("<p style='color: red;'>*Has to be a number</p>");
                }
                else if(antallVaraRepresentanter < grenseAntallVara){
                    $("#divFeilmld").show();
                    $("#divFeilTxt").html("Fikk ikke startet preferansevalg, se over skjema og prøv igjen.");
                    $("#divFeilVaraRep").html("<p style='color: red;'>*Unvalid number, try again.</p>");
                }
                else if(isNaN(antallRepresentanter))
                {
                    $("#divFeilmld").show();
                    $("#divFeilTxt").html("Error, try again.");
                    $("#divFeilRep").html("<p style='color: red;'>*Has to be a number<p>");
                }
                else{
                    $.ajax({
                        url: '/Bruker/startPreferansevalg',
                        data: {
                            beskrivelse: beskrivelse,
                            antallRepresentanter: antallRepresentanter
                        },
                        type: 'GET',
                        dataType: 'json',
                        success: function (melding) {
                            if (melding == "OK") {
                                $("#divFeilmld").hide();
                                $("#divFeilTxt").html(" ");
                                $("#divFeilRep").html(" ");
                                $("#divFeilBeskrivelse").html(" ");

                                window.location = "@Url.Action("PreferansevalgStartetEng", "Bruker")";
                            }
                            else if (melding == "feil") {
                                if(antallRepresentanter < 2){
                                    $("#divFeilmld").show();
                                    $("#divFeilTxt").html("Error, try again.");
                                    $("#divFeilRep").html("<p style='color: red;'>*Has to be at least 2</p>");
                                }
                                if(beskrivelse == ""){
                                    $("#divFeilmld").show();
                                    $("#divFeilTxt").html("Error, try again.");
                                    $("#divFeilBeskrivelse").html("<p style='color: red;'>*Fill in</p>");
                                }
                                $("#btnStartSTV ").show();
                            }
                        },
                        error: function (x, y, z) {
                        }
                    });
                }
            });

        }) //Her stopper function()


        //Funksjon som legger til kandidater fortløpende
        function leggTilRad(navn) {

            $.ajax({
                url: '/Bruker/lagreKandidatIListe',
                data: { id: navn },
                type: 'GET',
                dataType: 'json',
                success: function (melding) {
                    if (melding == "OK")
                    {
                        location.reload();
                    }
                    else if(melding == "Samme navn")
                    {
                        $('#modalFeilEng').modal('show');
                    }
                },
                error: function (x, y, z) {
                }
            });
        }

    </script>
</head>
<body>
    <div class="col-sm-12" id="containerSTV">
        @Html.ActionLink(" ", "IndexEng", new { /* id=item.PrimaryKey */ }, new { @class = "btn btn-default glyphicon glyphicon-home btn-md" })
        <div class="form-inline" style="float:right;">
            @Html.ActionLink("Back", "IndexEng", new { /* id=item.PrimaryKey */ }, new { @class = "btn btn-default" })
            <div class="dropdown" style="float:right;">
                <button class="btn btn-default dropdown-toggle" type="button" data-toggle="dropdown">
                    English 
                    <span class="caret"></span>
                </button>
                <ul class="dropdown-menu">
                    <li><a href="@Url.Action("PreferansevalgAdmin", "Bruker")">Norsk</a></li>
                </ul>
            </div>
        </div>
        <br />
        <h2><b>Single Transferable Vote</b></h2>
        <br />
        <p class="text-info">For starting a new S.T.V, please fill in the form</p>
        <br />
        <div class="form-horizontal">
       <div class="form-group form-inline">
                <div class="row col-sm-11">
                    <div class="col-sm-8">
                        <input type="text" class="form-control" id="kandidatNavn" placeholder="Name of the participating candidate" />
                       
                    </div>
                    <div class="col-sm-2">
                        <input type="button" value="Add new candidate" id="btnLeggTilKandidat" class="btn btn-info" />
                    </div>
                </div>
            </div>

            <table class="table table-hover table-nonfluid" id="tablePreferansevalg">
                <caption><h4 class="pull-left">Registered candidates</h4></caption>
                <thead>
                    <tr>
                        <th>#</th>
                        <th>Name</th>
                        <th>
                            <div class="pull-right">
                            </div>
                        </th>
                        <th>
                            <div class="pull-right">
                                <input type="button" value="Reset list" id="btnNullstillKandidater" class="btn btn-danger btn-sm" />
                            </div>
                        </th>
                    </tr>
                </thead>
                <tbody>

                    @{int i = 1;}
                    @foreach (var item in Model)
                    {
                        <tr>
                            <th scope="row">@i</th>
                            <td colspan="2">
                                @Html.DisplayFor(modelItem => item.navn)
                                <input type="hidden" id="hiddenValgtypeid" value="@item.valgtypeid" />
                            </td>
                            <td>
                                <div class="pull-right">
                                    @Html.ActionLink(" ", "slettKandidatFraListe", new { id = item.kandidatListeID }, new { @class = "btn btn-danger btn-md glyphicon glyphicon-remove" })
                                </div>
                            </td>
                        </tr>
                        i++;
                    }
                </tbody>
            </table>

            <br />
            <div class="form-group form-inline">
                <div class="row">
                    <div class="col-sm-2"></div>
                    <div id="divFeilmld" class="col-sm-8 pull-left alert alert-danger" style="display:none">
                        <div class="col-sm-12 pull-left"><div id="divFeilTxt"></div></div>
                    </div>
                </div>
            </div>
            <div class="form-group form-inline">
                <div class="row">
                    <div class="col-sm-4"></div>
                    <div id="divResultat" class="col-sm-8 pull-left alert alert-info" style="display:none">
                        <div class="col-sm-5 pull-left"><div id="divResultatTxt"></div></div>
                        <div class="col-sm-3">
                            <input type="button" class="form-control btn-sm btn-info" id="divResultatBtn" value="See result" />
                        </div>
                    </div>
                </div>
            </div>
            <div class="form-group form-inline">
                <div class="row col-sm-11">
                    <div class="col-sm-2">
                        <label for="BeskrivelseSTV">Description</label>
                    </div>
                    <div class="col-sm-5 col-sm-offset-2">
                        <input type="text" class="form-control" id="BeskrivelseSTV" />
                    </div>
                    <div class="col-sm-3" id="divFeilBeskrivelse">

                    </div>
                </div>
            </div>

            <div class="form-group form-inline">
                <div class="row col-sm-11">
                    <div class="col-sm-4">
                        <label for="antRepresentanter">Number of selections</label>
                    </div>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" id="antRepresentanter" />
                    </div>
                    <div class="col-sm-5" id="divFeilRep">

                    </div>
                </div>
            </div>
            <div class="form-group form-inline">
                <div class="row col-sm-11">
                    <div class="col-sm-4">
                        <label for="antVaraRepresentanter">Deputy representatives</label>
                    </div>
                    <div class="col-sm-2">
                        <input type="text" class="form-control" id="antVaraRepresentanter" />
                    </div>
                    <div class="col-sm-5" id="divFeilVaraRep">

                    </div>
                </div>
            </div>
            <div class="form-group">

                <div class="row">
                    <div class="col-sm-4"></div>
                    <div class="col-sm-6 col-lg-offset-1">
                        <input type="button" id="btnStartSTV" value="Start STV" class="btn btn-primary" />
                    </div>
                </div>
                <div class="col-sm-12"><hr id="hrSTV" /></div>
                <br />
                <div class="row col-sm-11">
                    <div class="col-sm-12">
                        @Html.ActionLink("Registered S.T.V", "ForhåndslagredePreferansevalgEng", new { tom = "" }, new { @class = "btn btn-info col-sm-4 col-sm-offset-2" })
                        @Html.ActionLink("Executed STV ", "AlleUtfortePreferansevalgEng", new { tom = "" }, new { @class = "btn btn-info col-sm-4 col-sm-offset-1" })
                    </div>
                </div>
            </div>
            <br />

            <div class="modal fade bs-example-modal-sm" tabindex="-1" role="dialog" aria-labelledby="mySmallModalLabel" id="modalFeilEng">
                <div class="modal-dialog modal-sm" role="document">
                    <div class="modal-content">
                        <div class="modal-header">
                            <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
                            <h4>Feil</h4>
                        </div>
                        <div class="modal-body">
                            <p style="color: red;">This name is already registered, please try again with a different name.</p>
                        </div>
                    </div>
                </div>
            </div>

        </div>
    </div>
    <br />
</body>
</html>

